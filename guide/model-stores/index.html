<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
        <title>Model Stores</title>

        <!-- CSS  -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="/assets/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="/assets/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="/assets/css/main.css" type="text/css" rel="stylesheet" media="screen,projection"/>

        <link rel="stylesheet" href="/assets/css/prism.css">

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/assets/favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/assets/favicon/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="/assets/favicon/manifest.json">
        <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#4f4f4f">
        <link rel="shortcut icon" href="/assets/favicon/favicon.ico">
        <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">
</head>
<body>

<header>

        <a href="https://github.com/zerothstack/zeroth#readme">
            <img style="position: absolute; top: 0; right: 0; border: 0;"
                 src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
                 alt="Fork me on GitHub"
                 data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
        </a>

    <nav class="top-nav" role="navigation">
        <div class="container">
            <a href="#" data-activates="nav-mobile"
               class="button-collapse top-nav waves-effect waves-light circle hide-on-large-only">
                <i class="material-icons">menu</i>
            </a>
        </div>

        <div class="nav-wrapper container">
            <ul class="left">
                <li><a class="waves-effect waves-light btn btn-flat white" style="text-transform: none;" target="_blank" href="https://github.com/zerothstack/zeroth#readme">@zerothstack/core v.1.0.4</a></li>
            </ul>
            <ul class="right">
                    <li class="active"><a href="/guide">Developer Guide</a></li>
                    <li class=""><a href="/api">API</a></li>
                    <li class=""><a href="/articles">Articles</a></li>
                    <li class=""><a href="/changelog">Changelog</a></li>
                    <li class=""><a href="/faq">FAQ</a></li>
            </ul>
        </div>
    </nav>

    
        <ul id="nav-mobile" class="side-nav fixed">
            <li class="logo">
                <a id="logo-container" href="/" class="brand-logo">
                    <img src="/assets/image/logo.svg" alt="Logo">
                </a>        </li>
    
                    <li class="no-padding">
                        <ul class="collapsible collapsible-accordion">
                            <li class="bold"><a class="active collapsible-header waves-effect waves-grey">Developer Guide</a>
                                <div class="collapsible-body">
                                    <ul>
                                            <li class="">
                                                <a href="/guide/quick-start">
                                                    <span>Quick Start</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/application-lifecycle">
                                                    <span>Application Lifecycle</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/cli">
                                                    <span>CLI</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/configuration">
                                                    <span>Configuration</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/controllers">
                                                    <span>Controllers</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/database">
                                                    <span>Database</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/dependency-injection">
                                                    <span>Dependency Injection</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/deployment">
                                                    <span>Deployment</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/documentation">
                                                    <span>Documentation</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/email">
                                                    <span>Email</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/exceptions">
                                                    <span>Exceptions</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/logging">
                                                    <span>Logging</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/middleware">
                                                    <span>Middleware</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/migrations">
                                                    <span>Migrations</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="active">
                                                <a href="/guide/model-stores">
                                                    <span>Model Stores</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/models">
                                                    <span>Models</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/queues">
                                                    <span>Queues</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/routing">
                                                    <span>Routing</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/seeding">
                                                    <span>Seeding</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/services">
                                                    <span>Services</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/testing">
                                                    <span>Testing</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/validation">
                                                    <span>Validation</span>
                                                    
                                                </a>
                                            </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="bold ">
                        <a href="/api" class="waves-effect waves-grey">API</a>
                    </li>
    
                    <li class="no-padding">
                        <ul class="collapsible collapsible-accordion">
                            <li class="bold"><a class=" collapsible-header waves-effect waves-grey">Articles</a>
                                <div class="collapsible-body">
                                    <ul>
                                            <li class="">
                                                <a href="/articles/zeroth-for-the-angular-developer">
                                                    <span>Zeroth for the Angular developer</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/articles/why-bother">
                                                    <span>Why bother?</span>
                                                    
                                                </a>
                                            </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="bold ">
                        <a href="/changelog" class="waves-effect waves-grey">Changelog</a>
                    </li>
                    <li class="bold ">
                        <a href="/faq" class="waves-effect waves-grey">FAQ</a>
                    </li>
        </ul>
    
</header><main>
    <div class="container">
        <h1>Model Stores</h1>

        <ul class="section table-of-contents">
                <li><a href="#overview"># Overview</a></li>
                <li><a href="#structure"># Structure</a></li>
                <li><a href="#mock-stores"># Mock Stores</a></li>
        </ul>

        <div class="contents"><h2 id="overview"><a class="heading-anchor" href="#overview"><span></span></a>Overview</h2>
<p>Model Stores are a way of providing a common interface for retrieval and saving of models.
There can be many types of store for the same model, depending on the service that the store is interacting with to do 
 that storage.</p>
<p>An example would be for the model <code>User</code>, the frontend would use the <code>UserHttpStore</code> to use the Angular <code>Http</code> service to
communicate via the REST API to get user models.</p>
<p>In the backend, the controller would use the <code>UserDatabaseStore</code> which communicates with the database to manage records.</p>
<p>The key point is that both <code>UserHttpStore</code> <strong>and</strong> <code>UserDatabaseStore</code> <em>implement</em> a common <code>UserStore</code> which defines
the interfaces that controllers should use to retrieve records.</p>
<p>This may seem rather complex, however bear in mind that you are managing both the frontend and backend interfaces simultaneously.
Ordinarily in a non-isomorphic stack, management of data storage would have completely separated logic, and often not even
be in the same language. By handling them at the same time, we can have common logic between them.</p>
<h2 id="structure"><a class="heading-anchor" href="#structure"><span></span></a>Structure</h2>
<p>See the diagram below to see where the stores sit in the directory structure and how their class relationships work</p>
<pre><code>src
&#x251C;&#x2500;&#x2500; browser
&#x2502;   &#x251C;&#x2500;&#x2500; stores
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; user.http.store.ts    class UserHttpStore extends HttpStore&lt;User&gt; implements UserStore
&#x251C;&#x2500;&#x2500; common
&#x2502;   &#x251C;&#x2500;&#x2500; models
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; user.model.ts         class User extends Model
&#x2502;   &#x2514;&#x2500;&#x2500; stores
&#x2502;       &#x251C;&#x2500;&#x2500; user.mock.store.ts    class UserMockStore extends MockStore&lt;User&gt; implements UserStore
&#x2502;       &#x2514;&#x2500;&#x2500; user.store.ts         abstract class UserStore extends Store&lt;User&gt;{
&#x2514;&#x2500;&#x2500; server
    &#x2514;&#x2500;&#x2500; stores
        &#x2514;&#x2500;&#x2500; user.db.store.ts      class UserDatabaseStore extends DatabaseStore&lt;User&gt; implements UserStore
</code></pre><p>One important thing to note is that the stores <em>implement</em> the UserStore, but <strong>they do not extend it</strong>. This is because
the controllers that use the store <code>@Inject</code> the <code>UserStore</code> - the controller does not care about the specific implementation.</p>
<p>This allows you to easily swap where the data is being pulled from. An example could be that you initially had your users
stored in the database, then you migrated to using <a target="_blank" href="https://auth0.com/">Auth0</a>. As all your controllers and services were injecting
<code>UserStore</code> the only change you need to make is to change the provider in your bootstrap.</p>
<p>Before</p>
<pre><code>let providers:ProviderDefinition[] = [
  provide(UserStore, {useClass: UserDatabaseStore}),
];
</code></pre><p>After</p>
<pre><code>let providers:ProviderDefinition[] = [
  provide(UserStore, {useClass: UserAuth0Store}),
];
</code></pre><p>A common technique is to implement a <code>MockStore</code> first, then worry about the connections to the database or third party
 services later. That way you can focus on user/API interface before you lock in your data structures.</p>
<h2 id="mock-stores"><a class="heading-anchor" href="#mock-stores"><span></span></a>Mock Stores</h2>
<p>Mock stores are for retrieving mock models that are instances of your <code>Model</code>, but have mocked data provided. They are
useful for <a href="/guide/testing">unit testing</a> and <a href="/guide/seeding">seeders</a>.</p>
<p>Mock stores must extend <code>MockStore&lt;T extends AbstractModel&gt;</code> so that they have the common methods of model retrieval.
The methods for persisting data are simply stubbed, as it doesn&#x2019;t make sense to save data to a mock store.</p>
<p>Example <code>./src/common/stores/user.mock.store.ts</code>:</p>
<pre class="line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserStore <span class="token punctuation">}</span> from <span class="token string">&apos;../../common/stores/user.store&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> from <span class="token string">&apos;../models/user.model&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> identifier<span class="token punctuation">,</span> MockStore <span class="token punctuation">}</span> from <span class="token string">&apos;@zerothstack/core/common&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injector<span class="token punctuation">,</span> Injectable <span class="token punctuation">}</span> from <span class="token string">&apos;@angular/core&apos;</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserMockStore</span> <span class="token keyword">extends</span> <span class="token class-name">MockStore</span><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token keyword">implements</span> <span class="token class-name">UserStore</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>injector<span class="token punctuation">:</span>Injector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> injector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token function">getMock</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">:</span>identifier<span class="token punctuation">)</span><span class="token punctuation">:</span>User <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>modelStatic</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      userId<span class="token punctuation">:</span> id <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">guid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      birthday<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        year<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>min<span class="token punctuation">:</span> <span class="token number">1900</span><span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>All a mock store needs to do is implement the <code>getMock(id?:identifier):T</code> interface, so that the parent <code>MockStore</code> can
retrieve mock models.</p>
<p>Available to the class is the <code>this.chance()</code> method, which returns an instance of <a target="_blank" href="http://chancejs.com/">ChanceJS</a> so you can have access to
a library of data mocking methods.</p>
</div>
    </div>
</main>


    <footer class="page-footer grey">
        <div class="row">
            <div class="col l8 s12">
                <div class="footer-copyright">
                    <div class="container">
                        Made by <a class="brown-text text-lighten-3" rel="author" href="http://twitter.com/zak">Zak Henry</a>
                    </div>
                </div>
            </div>
            <div class="col l4 s12">
                <section class="social">
                
                        <div class="row">
                            <iframe src="https://ghbtns.com/github-btn.html?user=zerothstack&repo=zeroth&type=star&count=true&size=large&v=2"
                                    frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
                        </div>
                
                        <div class="row">
                            <a href="https://gitter.im/zerothstack/zeroth?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge">
                                <img src="https://badges.gitter.im/zerothstack/zeroth.svg">
                            </a>
                        </div>
                
                
                        <div class="row">
                            <a href="https://twitter.com/zeroth" class="twitter-follow-button"
                               data-show-count="false"
                               data-size="large" data-dnt="true">Follow @zeroth</a>
                            <script>!function (d, s, id) {
                                var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
                                if (!d.getElementById(id)) {
                                    js     = d.createElement(s);
                                    js.id  = id;
                                    js.src = p + '://platform.twitter.com/widgets.js';
                                    fjs.parentNode.insertBefore(js, fjs);
                                }
                            }(document, 'script', 'twitter-wjs');</script>
                        </div>
                
                
                </section>            </div>
        </div>


    </footer>


    <!--  Scripts-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="/assets/js/materialize.js"></script>
    <script src="/assets/js/init.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-88015201-1', 'auto');
            ga('send', 'pageview');

        </script>

        <script>
            ((window.gitter = {}).chat = {}).options = {
                room: 'zerothstack/zeroth'
            };
        </script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

    </body>
</html>
