<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
        <title>Seeding</title>

        <!-- CSS  -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="/assets/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="/assets/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="/assets/css/main.css" type="text/css" rel="stylesheet" media="screen,projection"/>

        <link rel="stylesheet" href="/assets/css/prism.css">

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/assets/favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/assets/favicon/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="/assets/favicon/manifest.json">
        <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#4f4f4f">
        <link rel="shortcut icon" href="/assets/favicon/favicon.ico">
        <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">
</head>
<body>

<header>

        <a href="https://github.com/zerothstack/zeroth#readme">
            <img style="position: absolute; top: 0; right: 0; border: 0;"
                 src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
                 alt="Fork me on GitHub"
                 data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
        </a>

    <nav class="top-nav" role="navigation">
        <div class="container">
            <a href="#" data-activates="nav-mobile"
               class="button-collapse top-nav waves-effect waves-light circle hide-on-large-only">
                <i class="material-icons">menu</i>
            </a>
        </div>

        <div class="nav-wrapper container">
            <ul class="left">
                <li><a class="waves-effect waves-light btn btn-flat white" style="text-transform: none;" target="_blank" href="https://github.com/zerothstack/zeroth#readme">@zerothstack/core v.1.0.6</a></li>
            </ul>
            <ul class="right">
                    <li class="active"><a href="/guide">Developer Guide</a></li>
                    <li class=""><a href="/api">API</a></li>
                    <li class=""><a href="/articles">Articles</a></li>
                    <li class=""><a href="/changelog">Changelog</a></li>
                    <li class=""><a href="/faq">FAQ</a></li>
            </ul>
        </div>
    </nav>

    
        <ul id="nav-mobile" class="side-nav fixed">
            <li class="logo">
                <a id="logo-container" href="/" class="brand-logo">
                    <img src="/assets/image/logo.svg" alt="Logo">
                </a>        </li>
    
                    <li class="no-padding">
                        <ul class="collapsible collapsible-accordion">
                            <li class="bold"><a class="active collapsible-header waves-effect waves-grey">Developer Guide</a>
                                <div class="collapsible-body">
                                    <ul>
                                            <li class="">
                                                <a href="/guide/quick-start">
                                                    <span>Quick Start</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/application-lifecycle">
                                                    <span>Application Lifecycle</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/cli">
                                                    <span>CLI</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/configuration">
                                                    <span>Configuration</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/controllers">
                                                    <span>Controllers</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/database">
                                                    <span>Database</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/dependency-injection">
                                                    <span>Dependency Injection</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/deployment">
                                                    <span>Deployment</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/documentation">
                                                    <span>Documentation</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/email">
                                                    <span>Email</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/exceptions">
                                                    <span>Exceptions</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/logging">
                                                    <span>Logging</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/middleware">
                                                    <span>Middleware</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/migrations">
                                                    <span>Migrations</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/model-stores">
                                                    <span>Model Stores</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/models">
                                                    <span>Models</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="pending ">
                                                <a href="/guide/queues">
                                                    <span>Queues</span>
                                                    <i class="right material-icons">schedule</i> 
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/routing">
                                                    <span>Routing</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="active">
                                                <a href="/guide/seeding">
                                                    <span>Seeding</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/services">
                                                    <span>Services</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/testing">
                                                    <span>Testing</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/guide/validation">
                                                    <span>Validation</span>
                                                    
                                                </a>
                                            </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="bold ">
                        <a href="/api" class="waves-effect waves-grey">API</a>
                    </li>
    
                    <li class="no-padding">
                        <ul class="collapsible collapsible-accordion">
                            <li class="bold"><a class=" collapsible-header waves-effect waves-grey">Articles</a>
                                <div class="collapsible-body">
                                    <ul>
                                            <li class="">
                                                <a href="/articles/zeroth-for-the-angular-developer">
                                                    <span>Zeroth for the Angular developer</span>
                                                    
                                                </a>
                                            </li>
                                            <li class="">
                                                <a href="/articles/why-bother">
                                                    <span>Why bother?</span>
                                                    
                                                </a>
                                            </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="bold ">
                        <a href="/changelog" class="waves-effect waves-grey">Changelog</a>
                    </li>
                    <li class="bold ">
                        <a href="/faq" class="waves-effect waves-grey">FAQ</a>
                    </li>
        </ul>
    
</header><main>
    <div class="container">
        <h1>Seeding</h1>

        <ul class="section table-of-contents">
                <li><a href="#overview"># Overview</a></li>
                <li><a href="#registration"># Registration</a></li>
                <li><a href="#recommendations"># Recommendations</a></li>
                <li><a href="#current-status"># Current status</a></li>
        </ul>

        <div class="contents"><h2 id="overview"><a class="heading-anchor" href="#overview"><span></span></a>Overview</h2>
<p>Seeders are classes that define mock data to fill the database with for development and QA purposes.</p>
<p>When developing a new project locally, it can be quite a pain to set up your local database to have seed data that makes
sense to work with either when testing backend REST API&#x2019;s or developing user interfaces. Also, when a new teammember
 starts working on the project, they have to go through a painful process of replicating your database.</p>
<p>For QA testers, they need to go through the same process, and if some particularly curly bug occurs, it can sometimes
be difficult to work out if it was the starting conditions, or an actual bug.</p>
<p>When you add a new column, you are stuck with a choice of setting all rows to have the same value, or coming up with
some method to seed this missing data individually.</p>
<p>Seeders solve these issues by providing a repeatable, programmatic way of filling the database with realistic mock data,
which can be destroyed and re-run when the database schema changes, generating new mock data. </p>
<h2 id="registration"><a class="heading-anchor" href="#registration"><span></span></a>Registration</h2>
<p>Seeders are registered using the <code>@Seeder()</code> class decorator, and should all extend the <code>AbstractSeeder</code> class.
This class provides the common interface that the <code>SeederBootstrapper</code> uses to start the seeder running.</p>
<p>Example <code>./src/server/seeders/example.seeder.ts</code>:</p>
<pre class="line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserStore <span class="token punctuation">}</span> from <span class="token string">&apos;../../common/stores/user.store&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Logger<span class="token punctuation">,</span> Collection<span class="token punctuation">,</span> Seeder <span class="token punctuation">}</span> from <span class="token string">&apos;@zerothstack/core/common&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AbstractSeeder <span class="token punctuation">}</span> from <span class="token string">&apos;@zerothstack/core/server&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> from <span class="token string">&apos;../../common/models/user.model&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserMockStore <span class="token punctuation">}</span> from <span class="token string">&apos;../../common/stores/user.mock.store&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserDatabaseStore <span class="token punctuation">}</span> from <span class="token string">&apos;../stores/user.db.store&apos;</span><span class="token punctuation">;</span>

@<span class="token function">Seeder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleSeeder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSeeder</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>loggerBase<span class="token punctuation">:</span> Logger<span class="token punctuation">,</span> <span class="token keyword">protected</span> userStore<span class="token punctuation">:</span> UserStore<span class="token punctuation">,</span> <span class="token keyword">protected</span> userMockStore<span class="token punctuation">:</span> UserMockStore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>loggerBase<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMockStore<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mockModels<span class="token punctuation">:</span> Collection<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userStore as UserDatabaseStore<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>repo<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> repo<span class="token punctuation">.</span><span class="token function">persistMany</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>mockModels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>Example <code>./src/server/seeders/index.ts</code>:</p>
<pre class="line-numbers"><code class="language-typescript"><span class="token keyword">export</span> <span class="token operator">*</span> from <span class="token string">&apos;./example.seeder&apos;</span><span class="token punctuation">;</span>
</code></pre>
<p>Example <code>./src/server/main.ts</code>:</p>
<pre class="line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> bootstrap <span class="token punctuation">}</span> from <span class="token string">&apos;@zerothstack/core/server&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> as seeders from <span class="token string">&apos;./seeders&apos;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> BootstrapResponse <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span>seeders<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="recommendations"><a class="heading-anchor" href="#recommendations"><span></span></a>Recommendations</h2>
<p>The naive approach to seeders would be to create a seeder for each table. However this does not generate realistic 
database data - is there actually a way that a single isolated record can be created in every one of your tables? Probably
not.</p>
<p>Instead, the recommended approach is to think about seeders as user stories. Say you have an application where you sell
cars to a web user. Rather than creating a <code>CarSeeder</code>, <code>UserSeeder</code>, <code>CarFeatureSeeder</code>, <code>UserSelectionSeeder</code> etc, you
will get more realistic data if you create a <code>UserSignupSeeder</code>, <code>AdminCarEntrySeeder</code>, <code>UserCarPurchaseSeeder</code>.</p>
<p>Your goal when creating seeders should be to create as realistic data as is reasonable, so that when you are working with
it later on, you are dealing with a <code>Toyota Hilux</code> purchased by <code>Gary Peterson</code>, rather than <code>Foo car type</code> purchased
by <code>asdf1234</code>. Future you will thank current you ;)</p>
<p>For more information on <code>MockStores</code> for mocking the actual model data, see the <a href="/guide/model-stores/#mock-stores">mock store documentation</a></p>
<h2 id="current-status"><a class="heading-anchor" href="#current-status"><span></span></a>Current status</h2>
<p>Like <a href="/guide/migrations">migrations</a>, seeders are currently run on startup (immediately after migrations run). This is fine for local 
development, but is a slow process that you probably don&#x2019;t want running every time, even if you have a query check
if a table has been seeded.</p>
<p>In future, when migrations are moved into the runtime cli, seeders running will also be moved at the same time, and the
 cli will provide commands to run individual seeders.</p>
</div>
    </div>
</main>


    <footer class="page-footer grey">
        <div class="row">
            <div class="col l8 s12">
                <div class="footer-copyright">
                    <div class="container">
                        Made by <a class="brown-text text-lighten-3" rel="author" href="http://twitter.com/zak">Zak Henry</a>
                    </div>
                </div>
            </div>
            <div class="col l4 s12">
                <section class="social">
                
                        <div class="row">
                            <iframe src="https://ghbtns.com/github-btn.html?user=zerothstack&repo=zeroth&type=star&count=true&size=large&v=2"
                                    frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
                        </div>
                
                        <div class="row">
                            <a href="https://gitter.im/zerothstack/zeroth?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge">
                                <img src="https://badges.gitter.im/zerothstack/zeroth.svg">
                            </a>
                        </div>
                
                
                        <div class="row">
                            <a href="https://twitter.com/zeroth" class="twitter-follow-button"
                               data-show-count="false"
                               data-size="large" data-dnt="true">Follow @zeroth</a>
                            <script>!function (d, s, id) {
                                var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
                                if (!d.getElementById(id)) {
                                    js     = d.createElement(s);
                                    js.id  = id;
                                    js.src = p + '://platform.twitter.com/widgets.js';
                                    fjs.parentNode.insertBefore(js, fjs);
                                }
                            }(document, 'script', 'twitter-wjs');</script>
                        </div>
                
                
                </section>            </div>
        </div>


    </footer>


    <!--  Scripts-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="/assets/js/materialize.js"></script>
    <script src="/assets/js/init.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-88015201-1', 'auto');
            ga('send', 'pageview');

        </script>

        <script>
            ((window.gitter = {}).chat = {}).options = {
                room: 'zerothstack/zeroth'
            };
        </script>
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

    </body>
</html>
